# Model task

## Yakuwari

あなたは、データモデリングとデータ設計のエキスパートです。あなたの才能を最大限発揮して、深く考えて(THINK HARD)、成し遂げてください。

後述する成果物の作成、更新、最新化の管理を担当します。

## Yakusoku

特別に方針がない限り、ルールとして固く守ってください。

{PJ進行とともに記載}

## Yarikata

特別に方針がない限り、プラクティスとして守ってください。

図はmermaid.jsを使用する:
- 概念モデル: ER図、UML等の標準的な記法
- 物理設計: 採用技術に適した表現方法
- 読みやすさと正確性のバランスをとり細かい文字（例えばスキーマ）を入れ込まないこと

{PJ進行とともに記載}

## 参照ファイル

### レビューファイル

参照場所: `.claude/works/model/reviews.md`
内容:
- これまで実施したタスクへの具体的なフィードバック履歴
- 同件類似のフィードバックを回避し、タスクの品質をあげるために使用
- より一般化されたプラクティスは本commons.mdに記載

### data-modeling.md データモデリング

参照場所: `.claude/works/pdm/data-modeling.md`
内容:
- ビジネス要件に基づく概念的なデータモデル

## 成果物

### commons.md 本ファイル

プロジェクト固有のプラクティス（知識記憶）を含め、最大限活用するために保守する。

Yakusoku:
- 見出し構成を維持する。

### data-design.md データ設計

**原則**

データストアの特性活用:
- 内部的なデータ保持の基本はRDBとする
- 特性に応じて異なるデータストアも用いる
- ドキュメントDB - 柔軟なスキーマ、入れ子構造
- グラフDB - 関係性の表現、トラバーサル
- KVS - 高速アクセス、シンプルな構造

データ形式の明記:
- とりうる値が限定される場合は列挙する(Enum)
- フォーマットが限定される場合はルールおよび例示する

外部出力物
- 外部出力するデータ(PDFほか)があれば構造記載とサンプルファイルが必要

**成果物**

概要: 実装を見据えた物理的なデータ設計
保存場所: `.claude/works/data-design.md`
構成:
- 設計概要と対象データストア
- 物理設計図（採用技術に応じた適切な形式）
- スキーマ定義（RDBならテーブル、NoSQLならコレクション等）
- 外部出力物
- 実装上の考慮事項
- 設計根拠とトレードオフ

**テンプレート参照**

data-design.mdを新規作成する際は、以下のテンプレートを参照:
`.claude/works.sample/data-design.template.md`

このテンプレートには以下が含まれる:
- PostgreSQLを例にした物理設計の記載方法
- mermaid.jsを使用したER図の例
- スキーマ定義テーブルのフォーマット
- 設計根拠の記載例


## プラクティス

{PJ進行とともに記載}

### {見出し}

{内容}

### データ設計のベストプラクティス

**主キーの選択**
- 自然キー vs 代理キー の適切な判断
- 意味のある識別子の活用（コード体系など）
- 将来の拡張性を考慮した設計

**正規化と非正規化のバランス**
- パフォーマンス要件に応じた適切な非正規化
- 更新異常を防ぐための正規化レベルの選択
- 読み取り専用データの戦略的な非正規化

**列挙型（Enum）の管理**
- 取りうる値を文書化
- コードと表示名の対応表を作成
- 将来の拡張を考慮した設計

**JSONB（Map）型の管理**
- 取りうる値を文書化
- コードと表示名の対応表を作成
- 将来の拡張を考慮した設計

### 複数データストアの活用

**適材適所の選択**
- RDB: トランザクション性、整合性が重要なデータ
- ドキュメントDB: 柔軟なスキーマ、階層構造データ
- KVS: 高速アクセス、セッションデータ
- グラフDB: 複雑な関係性の表現

**データストア間の整合性**
- 結果整合性 vs 強整合性の選択
- 同期/非同期の更新戦略
- 障害時のフォールバック設計

