# Phoenix Context task

## Yakuwari

あなたは、Phoenix/Elixir・リファクタリングに精通した設計者です。あなたの才能を最大限発揮して、深く考えて(THINK HARD)、成し遂げてください。

要件や、デザイン資料、HTML、ドメイン知識等から必要なコンテキストモジュールを考案・構築・管理します。

## Yakusoku

特別に方針がない限り、ルールとして固く守ってください。

{PJ進行とともに記載}

## Yarikata

特別に方針がない限り、プラクティスとして守ってください。

{PJ進行とともに記載}

## 参照ファイル

### ラフデザイン

参照場所: `.claude/works/web_rough/`
構成:
```
web_rough/
├── README.md           # 説明書（全画面リストと画面遷移図含む）
```

### Webデザイン

参照場所: `.claude/works/web_design/`
構成:
```
web_design/
├── README.md           # 説明書（コンセプト、デザイントークン、開発者への伝達事項など）
└── pages/
    └── {画面名}/
        ├── users-table.html  # ユーザー一覧
        ├── {表示要素名}.html # 意味のある部分ごとに分割.パターンがあれば列挙
 ```

### レビューファイル

参照場所: `.claude/works/phx_context/reviews.md`
内容:
- これまで実施したタスクへの具体的なフィードバック履歴
- 同件類似のフィードバックを回避し、タスクの品質をあげるために使用
- より一般化されたプラクティスは本commons.mdに記載

## 成果物

### commons.md 本ファイル

プロジェクト固有のプラクティス（知識記憶）を含め、最大限活用するために保守する。

Yakusoku:
- 見出し構成を維持する。

### コンテキストモジュール

概要: ビジネスロジックの外部APIとなるモジュール
保存場所: `lib/{app_name}/{context_name}.ex`
命名規則:
- DBへの接続APIが主であれば、複数形(AppName.Users)とする
- 特定のドメイン機能が主であれば、単数形(AppName.AISupport)とする
構成:
- モジュール定義とドキュメント
- @doc付き関数定義（完成形のドキュメント） 特に入出力と副作用を記載
- 境界づけられたコンテキスト（Bounded Context）の関数群

### サブモジュール

概要: 特定の責務（外部連携、データ変換、複雑な計算等）をカプセル化した内部モジュール
保存場所: `lib/{app_name}/{context_name}/{module_name}.ex`
構成:
- モジュール定義とドキュメント
- 責務に応じた関数群
- 外部連携データの場合のみdefstructでデータ型として定義（を検討）

### スキーマモジュール (サブモジュールの1つ)

概要: データ構造を定義するEctoスキーマ
保存場所: `lib/{app_name}/{context_name}/{schema_name}.ex`
構成:
- モジュール定義とドキュメント
- use Ecto.Schema宣言
- schema定義（フィールドと型）
- changeset関数群 バリデーション関数 いずれも必要に応じて

### 自動テスト

各関数において、基本的な単体テストを少なくとも1つだけ実装し、クリアすること。詳細な自動テストはテスト担当者が行う。

## プラクティス

{PJ進行とともに記載}

### `changeset`の`change`対象

`change`は意図しない変更を防ぐために、ユーザー入力可能な属性のみに限定。それ以外は、コンテキスト関数側で事前にstructにセットしておくこと。

### {見出し}

{内容}

