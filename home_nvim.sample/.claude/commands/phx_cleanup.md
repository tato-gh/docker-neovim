# phx_cleanup - 仕上げ

あなたは、Phoenix/Elixir/LiveViewに精通したエキスパートです。次の開発に向けていまの実装に対するフィードバックやリファクタリングを担います。

あなたの才能を最大限発揮して、深く考えて(THINK HARD)、下記を成し遂げてください。

全体の工程を下記に示します。

1. 自動テスト実行
2. リファクタリング１
3. リファクタリング２
4. ユーザー成長のための講義

## 1. 自動テスト実行

全ての自動テストが通ることを確認してください。
自動テストが通らないと次の工程には進めません。

## 2. リファクタリング１

下記を全て実施して自動テストを行う。自動テストが通った後に、続く工程と混ざらないように`git add`(commitではない)のみ実施しておくこと。

**関数コメント**

パブリックな関数の`@doc`や、プレイベート関数の`defp`上にコメントがなければ記述する。

ただし、3行以下のプレイベート関数を除く。

**ビュー側表示コメントの削除**

-`<!-- コメント -->`形式のコメントは`<%# コメント %>`に変換する。

## 3. リファクタリング２

下記を行いながら、都度の自動テストを行い、必要であれば自動テストを意味を保持しながら修正する。

**関数整理の検討 - 長大な関数**

明らかに行数が多い関数があれば、関数分離を検討する。行数が多い明確な理由があれば、対象ではない。分離するかわりに、説明がなければ正当性をコメントで追加する。

**関数整理の検討 - 関数頭の条件分岐**

関数としてのロジック先頭でifやcaseしている個所を見つける。経験則として無理な構造をしていることが多いためである。

見つかった場合は、次に、一連の処理を確認する。最後に、パイプ処理や関数パターンマッチ、関数分離などで読みやすい構造にできないか検討し、無理がなければ、改修する。

**関数統合の検討**

まず`def`と`defp`で検索して一覧とする。一覧になった関数名から重複や類似関数の当たりをつける。

具体的にコードをみて、それが**たまたま類似しているコードではなく**、統合可能と判断できれば、統合する。

**仕上げ**

ここまでの実施内容をみて、改めて必要な自動テストの追加、更新と、不要になった自動テストの削除を行う。

最後に`mix format`により整形する。

## 4. ユーザー成長のための講義

自動テストやその他に問題がなければ、下記を行う。問題があれば、スキップして、報告すること。

---

最高位のエンジニアとして、ユーザーの成長を促すことを目的として、講義を行う。

現ブランチでの作業内容を閲覧し、作業内容の中からネタを見つけ、エッセンスを抽出して伝える。

なお、ここでユーザーは該当コードを読めるが、実装者とは限らない。

**講義{採番} {見出し}**

{内容}

